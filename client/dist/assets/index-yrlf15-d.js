(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();const c=document.getElementById("userDropdown");let i;c.addEventListener("change",function(){i=c.value,console.log("Selected User ID:",c.options[c.selectedIndex],c.value),y()});document.addEventListener("DOMContentLoaded",function(){i?(p(),i=c.value,console.log(c.value),console.log("Initially Selected User ID:",i)):L(),document.getElementById("closePopup").addEventListener("click",function(){document.getElementById("overlay").style.display="none"})});function L(){document.getElementById("overlay").style.display="flex"}async function p(){const n=await(await fetch("https://moody-faa.onrender.com/users")).json(),o=document.getElementById("userDropdown");o.innerHTML="",n.forEach(function(s){const e=document.createElement("option");e.textContent=s.username,e.value=s.id,o.appendChild(e)}),o.dispatchEvent(new Event("change")),y()}p();const h=document.getElementById("addUser");h.addEventListener("submit",async function(a){a.preventDefault();const n=new FormData(h),o=Object.fromEntries(n);try{const s=await fetch("https://moody-faa.onrender.com/users",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(o)}),e=await s.json();if(!s.ok)throw new Error(e.error||"Network response was not ok");console.log("Success:",e);const t=document.getElementById("userDropdown");t.innerHTML="",p()}catch(s){console.error("Error:",s.message),s.message.includes("Duplicate value detected.")&&alert("User already exists!")}c.selectedIndex=c.options.length-1});const B=document.getElementById("searchForm");B.addEventListener("submit",async function(a){a.preventDefault();const n=a.target.query.value;console.log(n),I(n)});async function I(a){const o=await(await fetch(`https://api.unsplash.com/search/photos?query=${a}&client_id=mGrCIgBZNFz0VK6M5r0Ku0ZuqH07Q3OfjhdbYqQWXwo`)).json();D(o.results)}async function D(a){document.getElementById("mainFeed").innerHTML="",a.forEach(function(n){const o=document.createElement("div");o.className="img-container";const s=document.createElement("img"),e=document.createElement("img"),t=document.createElement("p");t.textContent="image added!",t.style.display="none";const r=document.createElement("p");r.textContent="image already liked!",r.style.display="none",e.src="./images/heart.png",e.alt="like button",e.className="like-button",s.src=n.urls.regular,s.alt=n.alt_description,e.addEventListener("click",async function(d){d.stopImmediatePropagation(),console.log(n.urls.regular);const f=await(await fetch("https://moody-faa.onrender.com/userImages",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:i})})).json();let u=!1;for(let l=0;l<f.length;l++){const v=f[l].image_path,b=n.urls.regular;v==b&&(console.log("match",l),u=!0)}u===!0?(r.style.display="block",setTimeout(()=>{r.style.display="none"},1e3)):u===!1&&(t.style.display="block",setTimeout(()=>{t.style.display="none"},1e3));const w={id:i,imagePath:n.urls.regular,altTxt:n.alt_description};console.log("save image to userID:",i),await fetch("https://moody-faa.onrender.com/liked",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(w)})}),o.appendChild(s),o.appendChild(t),o.appendChild(r),o.appendChild(e),document.getElementById("mainFeed").appendChild(o)})}I("new year");const O=document.getElementById("thumbnails"),E=document.getElementById("mainImage");async function y(){const n=await fetch("https://moody-faa.onrender.com/userImages",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:i})});if(!n.ok){console.error("Error fetching user images:",n.status);return}const o=await n.json();console.log("image array",o);const s=document.getElementById("thumbnails");O.innerHTML="",o.forEach(e=>{const t=document.createElement("img"),r=document.createElement("div"),d=document.createElement("button");d.textContent="unlike",d.className="del-btn",t.src=e.image_path,t.alt=e.alt_text,console.log(e),t.className="thumbnail-img",r.appendChild(t),r.appendChild(d),s.appendChild(r),d.addEventListener("click",async function(g){g.stopImmediatePropagation();const m={id:e.id};await fetch("https://moody-faa.onrender.com/unlike",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(m)}),console.log("delete",m),r.remove()}),t.addEventListener("click",function(){E.style.backgroundImage=`url("${e.image_path}")`,console.log(E.style.backgroundImage)})})}y();
